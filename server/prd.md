# PRD: 이별 회복 지원 플랫폼 PoC

## 1. 프로젝트 개요

### 1.1 목적

이별을 경험한 사람들이 감정을 기록하고, AI를 통한 위로를 받으며, 커뮤니티를 통해 공감과 지지를 얻을 수 있는 모바일 플랫폼

### 1.2 핵심 가설

"사용자가 이 서비스를 통해 실질적인 위로를 받을 수 있고, 이를 통해 서비스 유지 및 재방문이 가능한가?"

### 1.3 기술 스택

- **Frontend**: Flutter
- **Backend**: NestJS
- **AI**: AWS Bedrock (감정 분석 및 위로 메시지 생성)
- **Auth**: 소셜 로그인

---

## 2. 핵심 기능 명세

### 2.1 회원가입 및 온보딩

### 2.1.1 소셜 로그인

- Google, Kakao, Apple 중 최소 1개 이상 지원
- 필수 수집 정보: 이메일, 닉네임

### 2.1.2 초기 설정

사용자는 회원가입 시 자신의 상태를 선택:

- **잊고파**: 이별한 상대를 잊고 새로운 시작을 원하는 상태
- **잡고파**: 관계 회복을 원하거나 미련이 남아있는 상태
- **중립**: 아직 마음을 정하지 못한 상태

**선택에 따른 영향:**

- 커뮤니티 게시판에서 선택한 카테고리의 게시물 우선 노출
- 앱 초기 테마/컬러 변경 (예: 잊고파-차분한 블루, 잡고파-보라색, 중립-중성 그레이)
- AI 위로 메시지 톤 조정

---

### 2.2 이별노트 (일기 기능)

### 2.2.1 일기 작성

**입력 요소:**

- 텍스트 입력란 (자유 형식)
- 작성 날짜/시간 자동 기록

**작성 완료 후 프로세스:**

1. 사용자가 "저장" 버튼 클릭
2. 백엔드에서 AWS Bedrock으로 텍스트 전송
3. AI가 다음 항목 분석 및 생성:
    - **감정 점수**: -100(매우 부정) ~ +100(매우 긍정) 범위의 수치
    - **감정 키워드**: 슬픔, 그리움, 분노, 희망 등 2-3개 태그
    - **위로 메시지**: 사용자의 감정에 공감하고 위로하는 200-300자 내외 메시지
4. 분석 결과와 함께 일기 저장
5. 사용자에게 위로 메시지 표시

**AI 프롬프트 가이드라인:**

```
역할: 당신은 이별을 경험한 사람을 공감하고 위로하는 심리 상담사입니다.

입력: 사용자의 일기 텍스트, 사용자 설정(잊고파/잡고파/중립)

출력:
1. emotion_score: -100 ~ +100 정수값
2. emotion_keywords: ["슬픔", "그리움"] 형태의 배열 (2-3개)
3. comfort_message: 200-300자의 위로 메시지

위로 메시지 작성 규칙:
- 사용자의 감정을 먼저 인정하고 공감
- 설정에 따라 톤 조정 (잊고파: 앞으로 나아가는 응원, 잡고파: 마음을 이해하고 지지)
- 구체적이고 개인화된 메시지
- 희망적이되 강요하지 않는 톤

```

### 2.2.2 일기 목록 및 조회

**목록 화면:**

- 시간 역순 정렬 (최신순)
- 각 일기 카드에 표시:
    - 작성 날짜
    - 일기 본문 미리보기 (첫 2줄)
    - 감정 점수 시각화 (이모티콘 또는 색상)
    - 감정 키워드 태그

**상세 화면:**

- 작성한 일기 전문
- AI 분석 결과 (감정 점수, 키워드)
- AI 위로 메시지
- 수정/삭제 버튼
- "커뮤니티에 공유하기" 버튼

### 2.2.3 일기 템플릿

사용자의 **감정 점수 평균**에 따라 일기 작성 화면의 템플릿 변경:

**긍정적 구간 (평균 +30 이상):**

- 밝은 컬러 스킴 (연한 노란색, 민트색 등)
- 플레이스홀더: "오늘은 어떤 좋은 일이 있었나요?"
- 격려 문구: "점점 나아지고 있어요 ✨"

**중립 구간 (평균 -30 ~ +30):**

- 중성 컬러 스킴 (화이트, 그레이 톤)
- 플레이스홀더: "오늘 하루는 어땠나요?"
- 격려 문구: "천천히 나아가고 있어요"

**부정적 구간 (평균 -30 이하):**

- 차분한 컬러 스킴 (연한 보라, 네이비 톤)
- 플레이스홀더: "힘든 마음을 편하게 털어놓으세요"
- 격려 문구: "괜찮아요, 함께할게요 💙"

**추가 템플릿 옵션 (PoC 후 확장 가능):**

- 질문형 템플릿: "오늘 가장 그리웠던 순간은?", "나에게 하고 싶은 말은?"
- 감사 일기 템플릿: "오늘 감사한 일 3가지"

### 2.2.4 커뮤니티 공유

- 일기 상세 화면에서 "공유하기" 버튼
- 공유 시 선택 옵션:
    - 닉네임 공개 / 익명
    - 카테고리 선택 (잊고파/잡고파/중립)
- 공유된 일기는 커뮤니티 게시판에 게시물로 등록
- 공유 후에도 원본 일기는 이별노트에 보관

---

### 2.3 커뮤니티 (게시판)

### 2.3.1 게시판 구조

**카테고리:**

- 잊고파
- 잡고파
- 중립

**게시물 노출 우선순위:**

- 사용자가 설정한 카테고리의 게시물 우선 표시
- 나머지 카테고리는 하단에 표시
- 각 카테고리 내에서는 최신순 정렬

### 2.3.2 게시물 작성

**작성 방식:**

1. 이별노트에서 공유 (주요 방식)
2. 직접 작성 (간단한 에디터 제공)

**게시물 구성 요소:**

- 제목 (선택, 없으면 본문 첫 줄 자동 추출)
- 본문 텍스트
- 작성자: 닉네임 또는 "익명"
- 카테고리 태그
- 작성 시간
- 댓글 수 표시

### 2.3.3 게시물 목록

**표시 정보:**

- 카테고리 배지
- 작성자 (닉네임/익명)
- 본문 미리보기 (3-4줄)
- 댓글 수
- 작성 시간 (상대 시간: "3시간 전", "2일 전")

**필터/정렬:**

- 카테고리 필터
- 정렬: 최신순(기본), 댓글많은순

### 2.3.4 게시물 상세 및 댓글

**상세 화면:**

- 전체 본문
- 작성자 정보
- 댓글 목록

**댓글 기능:**

- 댓글 작성 (닉네임 또는 익명 선택 가능)
- 댓글 목록 표시 (시간순)
- 댓글 삭제 (본인만 가능)

**상호작용:**

- PoC 단계에서는 댓글만 지원
- 향후 확장: 좋아요, 공감 이모티콘 등

---

### 2.4 마이페이지

### 2.4.1 프로필 정보

**표시 항목:**

- 프로필 사진 (선택)
- 닉네임
- 가입일
- 현재 설정 상태 (잊고파/잡고파/중립)

**편집 가능 항목:**

- 프로필 사진
- 닉네임
- 상태 변경 (잊고파/잡고파/중립)

### 2.4.2 활동 통계

- 작성한 일기 총 개수
- 커뮤니티 게시물/댓글 수

### 2.4.3 감정 변화 그래프

**타임라인 기반 시각화:**

- X축: 시간 (일/주/월 단위 선택 가능)
- Y축: 감정 점수 (-100 ~ +100)
- 꺾은선 그래프 형태
- 데이터 포인트: 각 일기의 감정 점수
- 평균선 표시 (전체 기간 평균)

**인사이트 표시:**

- "지난 7일간 평균 감정 점수: +15 (지난주 대비 +20 상승)"
- "가장 힘들었던 날: 2024.01.15"
- "가장 좋았던 날: 2024.01.20"

**기간 필터:**

- 최근 7일
- 최근 30일
- 최근 3개월
- 전체

### 2.4.4 기타 메뉴

- 내가 쓴 일기 목록 바로가기
- 내가 쓴 커뮤니티 글 바로가기
- 로그아웃

---

## 3. 데이터 모델

### 3.1 User (사용자)

```tsx
{
  id: string (UUID)
  email: string
  nickname: string
  profileImage?: string
  userType: 'FORGET' | 'HOLD' | 'NEUTRAL' // 잊고파/잡고파/중립
  socialProvider: 'GOOGLE' | 'KAKAO' | 'APPLE'
  socialId: string
  createdAt: DateTime
  updatedAt: DateTime
}

```

### 3.2 Diary (일기)

```tsx
{
  id: string (UUID)
  userId: string (FK)
  content: string // 일기 본문
  emotionScore: number // -100 ~ +100
  emotionKeywords: string[] // ["슬픔", "그리움"]
  comfortMessage: string // AI 위로 메시지
  isShared: boolean // 커뮤니티 공유 여부
  postId?: string (FK) // 공유된 경우 게시물 ID
  createdAt: DateTime
  updatedAt: DateTime
}

```

### 3.3 Post (게시물)

```tsx
{
  id: string (UUID)
  userId: string (FK)
  diaryId?: string (FK) // 일기에서 공유된 경우
  category: 'FORGET' | 'HOLD' | 'NEUTRAL'
  title?: string
  content: string
  isAnonymous: boolean
  authorNickname: string // 작성 시점의 닉네임 저장 (익명이면 "익명")
  commentCount: number // 비정규화 (성능)
  createdAt: DateTime
  updatedAt: DateTime
}

```

### 3.4 Comment (댓글)

```tsx
{
  id: string (UUID)
  postId: string (FK)
  userId: string (FK)
  content: string
  isAnonymous: boolean
  authorNickname: string // 작성 시점의 닉네임 저장
  createdAt: DateTime
  updatedAt: DateTime
}

```

---

## 4. API 명세 (주요 엔드포인트)

### 4.1 인증

- `POST /auth/social-login` - 소셜 로그인
- `POST /auth/signup` - 초기 설정 (닉네임, userType)
- `POST /auth/logout` - 로그아웃

### 4.2 일기

- `POST /diaries` - 일기 작성 (AI 분석 포함)
- `GET /diaries` - 내 일기 목록
- `GET /diaries/:id` - 일기 상세
- `PUT /diaries/:id` - 일기 수정
- `DELETE /diaries/:id` - 일기 삭제
- `POST /diaries/:id/share` - 커뮤니티 공유

### 4.3 커뮤니티

- `GET /posts` - 게시물 목록 (카테고리 필터, 페이징)
- `GET /posts/:id` - 게시물 상세
- `POST /posts` - 게시물 직접 작성
- `DELETE /posts/:id` - 게시물 삭제
- `POST /posts/:id/comments` - 댓글 작성
- `GET /posts/:id/comments` - 댓글 목록
- `DELETE /comments/:id` - 댓글 삭제

### 4.4 사용자

- `GET /users/me` - 내 프로필
- `PUT /users/me` - 프로필 수정
- `GET /users/me/stats` - 활동 통계
- `GET /users/me/emotion-graph` - 감정 변화 그래프 데이터

---

## 5. AI 통합 (AWS Bedrock)

### 5.1 감정 분석 Flow

```
1. 사용자 일기 작성 완료
   ↓
2. NestJS Backend에서 AWS Bedrock API 호출
   - Model: Claude 3.5 Sonnet 권장
   - Input: 일기 텍스트 + 사용자 설정(userType)
   ↓
3. Bedrock Response 파싱
   - emotionScore
   - emotionKeywords
   - comfortMessage
   ↓
4. DB 저장 및 클라이언트 응답

```

### 5.2 프롬프트 템플릿 예시

```tsx
const generatePrompt = (diaryText: string, userType: string) => {
  const typeContext = {
    FORGET: '사용자는 이별을 받아들이고 새로운 시작을 원합니다.',
    HOLD: '사용자는 관계 회복을 원하거나 아직 미련이 남아있습니다.',
    NEUTRAL: '사용자는 아직 마음을 정하지 못한 상태입니다.'
  };

  return `
당신은 이별을 경험한 사람을 공감하고 위로하는 심리 상담사입니다.

사용자 상태: ${typeContext[userType]}
일기 내용: ${diaryText}

다음 형식의 JSON으로 응답해주세요:
{
  "emotionScore": (number, -100 ~ +100),
  "emotionKeywords": (array of 2-3 strings),
  "comfortMessage": (string, 200-300자의 위로 메시지)
}

위로 메시지 작성 시:
1. 사용자의 감정을 먼저 인정하고 공감하세요
2. 사용자의 상태에 맞는 톤으로 작성하세요
3. 구체적이고 개인화된 메시지를 제공하세요
4. 희망적이되 강요하지 않는 톤을 유지하세요
  `;
};

```

### 5.3 에러 처리

- Bedrock API 호출 실패 시:
    - 기본 감정 점수: 0 (중립)
    - 기본 키워드: ["감정 분석 중"]
    - 기본 위로 메시지: "당신의 마음을 이해합니다. 힘든 시간을 보내고 계시는군요. 천천히 나아가도 괜찮아요."
- 재시도 로직: 최대 2회
- 타임아웃: 10초

---

## 6. 화면 구성 (주요 스크린)

### 6.1 온보딩

1. **소셜 로그인 화면**
2. **상태 선택 화면** (잊고파/잡고파/중립)
3. **닉네임 설정 화면**

### 6.2 메인 네비게이션 (Bottom Tab)

- 이별노트 (일기)
- 커뮤니티
- 마이페이지

### 6.3 이별노트 섹션

1. **일기 목록 화면**
2. **일기 작성 화면** (템플릿 적용)
3. **일기 상세 화면** (AI 분석 + 위로 메시지)

### 6.4 커뮤니티 섹션

1. **게시물 목록 화면** (카테고리 탭)
2. **게시물 상세 화면** (댓글 포함)
3. **게시물/댓글 작성 모달**

### 6.5 마이페이지 섹션

1. **프로필 메인 화면**
2. **감정 변화 그래프 화면**
3. **프로필 편집 화면**

---

## 7. UI/UX 가이드라인

### 7.1 컬러 시스템

**사용자 설정별 Primary Color:**

- 잊고파: #4A90E2 (차분한 블루)
- 잡고파: #C8A2C8 (보라색)
- 중립: #95A5A6 (중성 그레이)

**감정 점수별 Color:**

- 긍정 (+30 이상): #2ECC71 (그린)
- 중립 (-30 ~ +30): #95A5A6 (그레이)
- 부정 (-30 이하): #8E44AD (퍼플)

### 7.2 타이포그래피

- 제목: 18-24pt, Bold
- 본문: 14-16pt, Regular
- 캡션: 12pt, Light

### 7.3 인터랙션

- 일기 저장 시 AI 분석 중 로딩 인디케이터 표시
- 위로 메시지는 fade-in 애니메이션으로 부드럽게 표시
- 감정 그래프는 애니메이션과 함께 그려짐

---

## 8. PoC 성공 지표

### 8.1 정량 지표

- **일기 작성률**: 가입 후 7일 내 3회 이상 작성한 사용자 비율 > 40%
- **재방문율**: 주 2회 이상 재방문 사용자 비율 > 30%
- **AI 위로 메시지 만족도**: 설문 또는 피드백 버튼 통해 측정 > 평균 3.5/5
- **커뮤니티 참여율**: 게시물 또는 댓글 1회 이상 작성한 사용자 > 20%

### 8.2 정성 지표

- 사용자 인터뷰 또는 피드백:
    - "AI 위로 메시지가 실제로 도움이 되었나요?"
    - "앱을 통해 마음의 위안을 얻었나요?"
    - "계속 사용하고 싶은가요?"

### 8.3 수집할 데이터

- 일기 작성 빈도 및 시간대
- 감정 점수 분포 및 변화 추이
- 커뮤니티 게시물/댓글 수
- AI 위로 메시지에 대한 반응 (향후: 좋아요/싫어요 버튼)
- 사용자 리텐션 코호트 분석

---

## 9. 개발 우선순위 (Phase)

### Phase 1: MVP Core (2-3주)

- [ ]  소셜 로그인 및 온보딩
- [ ]  이별노트 CRUD
- [ ]  AWS Bedrock 통합 (감정 분석 + 위로 메시지)
- [ ]  기본 UI/테마 시스템

### Phase 2: 커뮤니티 (1-2주)

- [ ]  게시판 CRUD
- [ ]  댓글 기능
- [ ]  일기 공유 기능

### Phase 3: 마이페이지 & 분석 (1주)

- [ ]  프로필 관리
- [ ]  감정 변화 그래프
- [ ]  활동 통계

### Phase 4: 폴리싱 & 테스트

- [ ]  다양한 일기 템플릿
- [ ]  UI/UX 개선
- [ ]  베타 테스터 피드백 반영

---

## 10. 기술적 고려사항

### 10.1 성능

- 일기 목록/게시물 목록: 페이지네이션 또는 무한 스크롤
- 이미지 최적화: 프로필 사진은 리사이징 후 저장
- API 응답 캐싱 (특히 감정 그래프 데이터)

### 10.2 확장성

- AI 분석은 비동기 처리 가능하도록 설계 (Queue 사용 가능)
- 감정 점수 계산 로직은 별도 서비스로 분리 가능

### 10.3 모니터링

- AWS Bedrock API 호출 성공률 및 응답 시간
- 사용자 행동 로깅 (Firebase Analytics 또는 Mixpanel)
- 에러 추적 (Sentry 등)

---

## 11. 향후 확장 가능성

PoC 성공 후 고려할 기능들:

- **푸시 알림**: 일기 작성 리마인더, 커뮤니티 댓글 알림
- **전문가 상담 연결**: 심리 상담사 매칭
- **챌린지 시스템**: 30일 일기 쓰기 챌린지
- **추억 타임캡슐**: 특정 기간 후 다시 보기
- **친구 기능**: 서로 응원하기
- **다국어 지원**

---

## 12. 리스크 및 대응

| 리스크 | 영향도 | 대응 방안 |
| --- | --- | --- |
| AWS Bedrock 비용 증가 | 중 | 무료 티어 활용, 캐싱 전략, 호출 횟수 제한 |
| AI 위로 메시지 품질 낮음 | 높음 | 프롬프트 지속 개선, 사용자 피드백 수집 |
| 사용자 참여 저조 | 높음 | 초기 온보딩 개선, 푸시 알림, 리워드 시스템 |
| 커뮤니티 악성 댓글 | 중 | 신고 기능, 관리자 모니터링 (초기는 수동) |
| 소셜 로그인 장애 | 중 | 다중 로그인 제공, 에러 핸들링 |

---

## 13. 일정 (예상)

- **Week 1-2**: 인증, 일기 CRUD, AI 통합
- **Week 3-4**: 커뮤니티 기능
- **Week 5**: 마이페이지, 그래프
- **Week 6**: 테스트, 버그 수정, 폴리싱
- **Week 7**: 베타 출시 및 피드백 수집



